package com.dvclab.dockerhub.auth;

import com.dvclab.dockerhub.service.ContainerService;
import one.rewind.nio.json.JSON;
import one.rewind.nio.web.auth.KeycloakAdapter;
import org.junit.Test;

import java.io.IOException;
import java.net.URISyntaxException;
import java.util.List;

public class KeycloakAdapterTest {

    @Test
    public void deleteResource() throws IOException {
        String resource_id = "ed166e5d-80ff-b502-5696-54004748a4bd";
        KeycloakAdapter.getInstance().deleteResource(resource_id);
    }

    @Test
    public void exchangeToken() throws IOException, URISyntaxException {
        String token = "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJGTU9MU2xvTFZHQzQwRXE4VVROZ3liQXhtUzNrRTRPV21ibExERmY3ZkswIn0.eyJleHAiOjE2MjgwNzkwNzQsImlhdCI6MTYyODA3MTg3NCwiYXV0aF90aW1lIjoxNjI4MDY4MzEyLCJqdGkiOiI4YTQzMDdkNC1kMGExLTQzYjAtODNiMi05NTVkMTEyOThiNjEiLCJpc3MiOiJodHRwczovL2F1dGguZHZjbGFiLmNvbS9hdXRoL3JlYWxtcy9EdmNMQUIiLCJhdWQiOlsicmVhbG0tbWFuYWdlbWVudCIsImFjY291bnQiXSwic3ViIjoiNWVjOGEyYzQtYzc5NC00Yzg5LWJmOGMtNWFmYWYyZWVhMmE2IiwidHlwIjoiQmVhcmVyIiwiYXpwIjoiZnJvbnRfZW5kIiwibm9uY2UiOiI0YTA4NjliMC02MjNhLTQ5ZDYtODA4MS1hMTQ3NjVkN2NmNDEiLCJzZXNzaW9uX3N0YXRlIjoiNTYwODgxMmQtNDFkMC00OWNkLWJjNmEtYTk0YmM4NTdjZjU0IiwiYWNyIjoiMCIsImFsbG93ZWQtb3JpZ2lucyI6WyIqIl0sInJlYWxtX2FjY2VzcyI6eyJyb2xlcyI6WyJvZmZsaW5lX2FjY2VzcyIsInVtYV9hdXRob3JpemF0aW9uIiwiRE9DS0hVQl9BRE1JTiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7InJlYWxtLW1hbmFnZW1lbnQiOnsicm9sZXMiOlsidmlldy1yZWFsbSIsInZpZXctaWRlbnRpdHktcHJvdmlkZXJzIiwibWFuYWdlLWlkZW50aXR5LXByb3ZpZGVycyIsImltcGVyc29uYXRpb24iLCJyZWFsbS1hZG1pbiIsImNyZWF0ZS1jbGllbnQiLCJtYW5hZ2UtdXNlcnMiLCJxdWVyeS1yZWFsbXMiLCJ2aWV3LWF1dGhvcml6YXRpb24iLCJxdWVyeS1jbGllbnRzIiwicXVlcnktdXNlcnMiLCJtYW5hZ2UtZXZlbnRzIiwibWFuYWdlLXJlYWxtIiwidmlldy1ldmVudHMiLCJ2aWV3LXVzZXJzIiwidmlldy1jbGllbnRzIiwibWFuYWdlLWF1dGhvcml6YXRpb24iLCJtYW5hZ2UtY2xpZW50cyIsInF1ZXJ5LWdyb3VwcyJdfSwiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJvcGVuaWQgcHJvZmlsZSBlbWFpbCB1c2VyaW5mbyIsImVtYWlsX3ZlcmlmaWVkIjpmYWxzZSwiYXZhdGFyX3VybCI6Imh0dHBzOi8vYXZhdGFycy5naXRodWJ1c2VyY29udGVudC5jb20vdS83MjY5MDAyND92PTQiLCJuYW1lIjoi5rW35rOiIOa4uCIsInByZWZlcnJlZF91c2VybmFtZSI6InlvdXppMTAzMCIsImdpdmVuX25hbWUiOiLmtbfms6IiLCJmYW1pbHlfbmFtZSI6Iua4uCIsImVtYWlsIjoieWhibWFzdGVyMTAxQGdtYWlsLmNvbSIsImVuYWJsZWQiOnRydWV9.FLJEZNDO1R3_duOxztFxYGDDMMjqn83PpMyGneoM5SSieUsrK6beue-PwOJ9x3Khlmp-GIfVuRBuU7lQHlguG_g-EWzPpNHSFNPjs_bQfjwuG9AbYAT1C8LR87g6m5rdkxAC0zQpIrAXw49US2BnoEYBJm5dVqtJrXYevACiWmDGeCLIy3JjLzhHTN1PGbLxbVgVyfdZBor28BMCInPi31pFFvEQmhE6NW2wHFY6_iJ-zf1m2h_64jtjcwjpFKrQkhH7-6CTOHB3dt277M1P6lyVY14EWbKM46HLgOE_OkusskoYQMKZHqK0fsq5ukPcFU_4I6dxgB2muZTIJkyWEg";
        System.out.println(KeycloakAdapter.getInstance().exchangeToken(token));
    }

    @Test
    public void applyResourcePolicy() throws IOException, URISyntaxException {

        String token = "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJGTU9MU2xvTFZHQzQwRXE4VVROZ3liQXhtUzNrRTRPV21ibExERmY3ZkswIn0.eyJleHAiOjE2MTc4OTAyNjMsImlhdCI6MTYxNzg4ODQ2MywiYXV0aF90aW1lIjoxNjE3ODg3NTkyLCJqdGkiOiI0MWJkNjI0ZS00MmU4LTQwNTItYjAzNy0yY2JjMTY3NjZlN2IiLCJpc3MiOiJodHRwczovL2F1dGguZHZjbGFiLmNvbS9hdXRoL3JlYWxtcy9EdmNMQUIiLCJhdWQiOlsiYWNjb3VudCIsImR2Y2xhYiJdLCJzdWIiOiI4ZjVmY2IxOS04NTUwLTRhZDgtYTZlNC0xMzYwZmM1NjU4ZDciLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJkdmNsYWIiLCJzZXNzaW9uX3N0YXRlIjoiN2YzOTBkNzctOTZhOC00OGFjLTk2OWMtMGM1ZGY4M2E3NjJhIiwiYWNyIjoiMSIsInJlYWxtX2FjY2VzcyI6eyJyb2xlcyI6WyJET0NLSFVCX1VTRVIiLCJET0NLSFVCX0FETUlOIl19LCJyZXNvdXJjZV9hY2Nlc3MiOnsiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIHVzZXJpbmZvIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJhdmF0YXJfdXJsIjoiaHR0cHM6Ly90aGlyZHd4LnFsb2dvLmNuL21tb3Blbi92aV8zMi9NZFdjckl1VUlWT1lzckZCNFhGYmZVdlJPbGVhZnhESjhpYmUyVTlCM204MUp1dTY3c1ROUTV2VWlhODNubWlhazczeVhZYmRza05ybWdDTTZSSm1ZTGtTdy8xMzIiLCJuYW1lIjoiTGFuaHVpIExpIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiZ29vZG5pZ2h0IiwiZ2l2ZW5fbmFtZSI6Ikxhbmh1aSIsImZhbWlseV9uYW1lIjoiTGkiLCJlbWFpbCI6Imdvb2RuaWdodGxpbGFuaHVpQGdtYWlsLmNvbSIsImVuYWJsZWQiOnRydWV9.i_SgWgMrL53R51Z8fancQcrA0rP9Z-mtMX-Nr4X__TrfeGgCCMvm9IwsO9dHCvDp8kbif_AsFTeOWp9udTTfzhbC4iveycdtbTqijaBzk0PgxTj9sgecrSyhCrwIbZGhc544ULM8W3E4PlZMgeFAxd7_QdIehdK4qKNxNfsERUUIeqRj_itYQI9KYnExOTQ-SCBf6QEex3Uu-TIBvGw1Q0KliT59kChs4rw4o4zNX0QzxizUrS7vZY7GDHXp4X2ShG4Ti_RgzoF_P36ZdG2NBhJISzUsZA0kzlYQEjSQWelh95EXANFXfYnfjWvaFlGrIII7rPweIkF3ats8WNOk4w";
        String resource_id = new StringBuilder("3101277246277cd6d3d70b435eb9f35e").insert(8, "-")
                .insert(13, "-")
                .insert(18, "-")
                .insert(23, "-").toString();
        ContainerService.ApplyResourcePolicyBody arp_body = new ContainerService.ApplyResourcePolicyBody()
                .withDesc("1"+ "_access_" + "3101277246277cd6d3d70b435eb9f35e")
                .withName("1" + "_access_" + "3101277246277cd6d3d70b435eb9f35e")
                .withScopes(List.of("view"))
                .withUsers(List.of("goodnight"));
        KeycloakAdapter.getInstance().applyResourcePolicy(token, resource_id, JSON.toJson(arp_body));
    }
}